
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module ThumbJIT</title>
<meta name="description" content="Documentation of Coq module ThumbJIT" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module ThumbJIT</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">compcert</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html">Integers</a></span>.<br/>
<span class="kwd">From</span> <span class="id">compcert.arm</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html">AsmSyntax</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinSyntax.html">BinSyntax</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html">BinDecode</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">bpf.comm</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="bpf.comm.Flag.html">Flag</a></span> <span class="id"><a href="bpf.comm.BinrBPF.html">BinrBPF</a></span> <span class="id"><a href="bpf.comm.ListAsArray.html">ListAsArray</a></span> <span class="id"><a href="bpf.comm.Regs.html">Regs</a></span>.<br/>
<span class="kwd">From</span> <span class="id">bpf.rbpf32</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html">TSSyntax</a></span> <span class="id"><a href="bpf.rbpf32.TSDecode.html">TSDecode</a></span> <span class="id"><a href="bpf.rbpf32.JITConfig.html">JITConfig</a></span>.<br/>
<span class="kwd">From</span> <span class="id">bpf.jit</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="bpf.jit.Arm32Reg.html">Arm32Reg</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html">ThumbInsOp</a></span> <span class="id"><a href="bpf.jit.ListSetSort.html">ListSetSort</a></span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Arith.html">Arith</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html">ListSet</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">bool_scope</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">asm</span>.<br/>
<br/>
<h1> ARM IR12 is FP for CompCert </h1>
<br/>
<h1> Functions in ARM </h1>
<br/>
<div class="doc">It consists of:
1. Prologue: (PUSH+ADD+SUB) save the previous state of the program (by storing values of LR and R11 onto the Stack) and set up the Stack for the local variables of the function. 
2. Body
3. Epilogue: (SUB+POP) restore the program’s state to it’s initial one (before the function call) so that it can continue from where it left of. For that we need to readjust the Stack Pointer.
However, in our jitted thumb code, we adopt a non-standard calling conversion, or, in other word, our `self-defined calling conversion`.
</div>
<br/>
<h1> ARM32 Stack Frame Layout </h1>
<br/>
<div class="doc">Since 2022-10-18, we decide to adopt a static ARMReg-stack mapping relation that is used for the SAVE &amp; RESET stage:
  IR_i &lt;---&gt; Stack <span class="bracket"><span class="id">i</span>*4, <span class="id">i</span>*4+4) <span class="kwd">where</span> <span class="id">i</span> \<span class="kwd">in</span> [4,11]
  <span class="id">BTW</span>,
  - <span class="id">Stack</span>[ 0, 4) = <span class="id">old</span> <span class="id">SP</span> (** <span class="id">done</span> <span class="tactic">by</span> <span class="id">compcertbin</span> / <span class="id">user</span>-<span class="id">defined</span> <span class="id">magic</span> <span class="id">function</span> *)
  - <span class="id">Stack</span>[ 4, 8) = <span class="id">current</span> <span class="id">r1</span> <span class="id">value</span> (** <span class="kwd">if</span> <span class="id">r1</span> <span class="kwd">is</span> <span class="id">used</span> <span class="id">before</span>, <span class="id">we</span> <span class="id">need</span> <span class="id">to</span> <span class="id">save</span> <span class="id">it</span> <span class="id">firstly</span>, <span class="kwd">then</span> <span class="id">use</span> <span class="id">it</span> <span class="kwd">as</span> <span class="id">flag_addr</span> <span class="id">to</span> <span class="id">modify</span> <span class="id">bpf_flag</span>, <span class="id">and</span> <span class="id">finally</span> <span class="id">recover</span> <span class="id">r1</span> *)
  - <span class="id">Stack</span>[ 8,12) = <span class="id">flag_addr</span>
  - <span class="id">Stack</span>[12,16) = <span class="id">unused</span>
 *)

(**

<span class="id">In</span> <span class="id">current</span> <span class="id">version</span>, <span class="id">we</span> <span class="id">consider</span> <span class="id">stack</span> <span class="kwd">as</span> <span class="id">a</span> <span class="id">special</span> <span class="id">memory</span>, <span class="id">so</span> <span class="id">we</span> <span class="id">just</span> <span class="tactic">do</span> <span class="id">load</span> <span class="id">and</span> <span class="id">store</span> <span class="id">but</span> <span class="id">never</span> <span class="id">modify</span> <span class="id">fp</span> &amp; <span class="id">sp</span>, <span class="id">it</span> <span class="kwd">is</span> <span class="id">ok</span> <span class="id">because</span> <span class="id">we</span> <span class="id">only</span> <span class="id">has</span> <span class="id">BPF</span> <span class="id">alu32</span>. <span class="id">We</span> <span class="id">should</span> <span class="id">modify</span> <span class="id">this</span> <span class="id">strategy</span> <span class="kwd">if</span> <span class="id">we</span> <span class="id">consider</span> <span class="id">BPF</span> <span class="id">call</span> <span class="id">instruction</span>.

<span class="id">CompCertBin</span> <span class="id">will</span> <span class="id">allocate</span> <span class="id">a</span> <span class="id">new</span> <span class="id">block</span> (<span class="kwd">where</span> <span class="id">save</span> <span class="id">the</span> <span class="id">IR</span>, <span class="id">i.e</span>. <span class="id">IR12</span>, <span class="id">i.e</span>. <span class="id">the</span> <span class="id">old</span> <span class="id">SP</span> <span class="id">into</span> <span class="id">the</span> <span class="id">location</span> 0) <span class="kwd">for</span> <span class="id">jitted</span> <span class="id">thumb</span>, <span class="id">and</span> <span class="id">it</span> <span class="id">will</span> <span class="id">start</span> <span class="id">from</span> 0!!!

 <span class="id">high</span> <span class="id">addr</span>
+---------+ * <span class="id">stack_size</span> = 12 * 4
/  <span class="id">R11</span>   /
/        /
/  <span class="id">R4</span>    /
/ <span class="id">unused</span> /
/ <span class="id">unused</span> /
/   <span class="id">R1</span>   /
/ <span class="id">old</span> <span class="id">SP</span> /
+---------+  (&lt;--- <span class="id">SP</span>) * <span class="id">current</span> <span class="id">SP</span> <span class="id">points</span> <span class="id">to</span> <span class="id">here</span>
 <span class="id">low</span> <span class="id">addr</span>


+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+
| <span class="id">R0</span> | <span class="id">R1</span> | -  | -  | -  | -  | -  | -  | -  | -  | -  | <span class="id">FP</span> | <span class="id">IP</span> | <span class="id">SP</span> | <span class="id">RA</span> | <span class="id">PC</span> |
+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+

==&gt; // <span class="tactic">move</span> <span class="id">R1</span> <span class="id">to</span> <span class="id">IR12</span> (<span class="id">now</span> <span class="id">IR12</span> <span class="id">stores</span> <span class="id">the</span> <span class="id">starting</span> <span class="id">address</span> <span class="id">of</span> <span class="id">bpf</span> <span class="id">state</span>)

+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+
| <span class="id">R0</span> | <span class="id">R1</span> | -  | -  | -  | -  | -  | -  | -  | -  | -  | <span class="id">FP</span> | <span class="id">IP</span> | <span class="id">SP</span> | <span class="id">RA</span> | <span class="id">PC</span> |
+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+

==&gt; // <span class="id">calling</span> <span class="id">conversion</span> (<span class="id">save</span> <span class="id">all</span> <span class="id">related</span> <span class="id">registers</span> <span class="id">from</span> <span class="id">R0</span>-<span class="id">R10</span> <span class="id">into</span> <span class="id">the</span> <span class="id">stack</span>, <span class="id">may</span> <span class="id">save</span> <span class="id">FP</span>)

+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+
| <span class="id">R0</span> | <span class="id">R1</span> | <span class="id">R2</span> | <span class="id">R3</span> | <span class="id">R4</span> | <span class="id">R5</span> | <span class="id">R6</span> | <span class="id">R7</span> | <span class="id">R8</span> | <span class="id">R9</span> | <span class="id">R10</span>| <span class="id">FP</span> | <span class="id">IP</span> | <span class="id">SP</span> | <span class="id">RA</span> | <span class="id">PC</span> |
+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+

<span class="id">Now</span> <span class="id">R0</span>-<span class="id">R10</span> <span class="id">are</span> <span class="id">ready</span> <span class="kwd">for</span> <span class="id">loading</span> <span class="id">rBPF</span> <span class="id">related</span> <span class="id">registers</span>.
*)


(** * <span class="id">Mapping</span> <span class="id">from</span> <span class="id">rBPF</span> <span class="id">Registers</span> <span class="id">to</span> <span class="id">ARM32</span> <span class="id">Registers</span>

<span class="id">rBPF</span> ---&gt; <span class="id">ARM32</span>
<span class="id">R0</span>         <span class="id">R0</span>
   ...
<span class="id">R10</span>        <span class="id">R10</span>


<span class="id">We</span> <span class="id">DO</span> <span class="id">accept</span> <span class="kwd">if</span> <span class="id">dst</span> <span class="id">or</span> <span class="id">src</span> <span class="kwd">is</span> <span class="id">R10</span>.
 *)


(** * <span class="id">Jitted</span> <span class="id">ARM</span> <span class="id">Instructions</span>
<span class="id">For</span> <span class="id">each</span> <span class="id">jitted</span> <span class="id">thumb</span> <span class="id">instruction</span> <span class="id">segment</span>, <span class="id">it</span> <span class="id">has</span> <span class="id">the</span> <span class="id">following</span> <span class="id">structure</span>:

<span class="id">mov</span> <span class="id">r12</span>, <span class="id">r1</span>;                               (**<span class="id">r</span> <span class="id">Pre</span>  <span class="id">Stage</span> *)
<span class="id">str</span> <span class="id">ri</span>,  [<span class="id">sp</span>, #(<span class="id">i</span>*4)];                     (**<span class="id">r</span> <span class="kwd">Save</span> <span class="id">Stage</span> *) <span class="id">i</span> \<span class="kwd">in</span> [4-11]
<span class="id">ldr</span> <span class="id">ri</span>,  [<span class="id">r12</span>, #(<span class="id">i</span>*8 + 8)];                (**<span class="id">r</span> <span class="kwd">Load</span> <span class="id">Stage</span> *) <span class="id">i</span> \<span class="kwd">in</span>[0, 10]
<span class="id">jitted</span> <span class="id">thumb</span>;                              (**<span class="id">r</span> <span class="id">Jitted</span> <span class="id">Stage</span> *)
<span class="id">str</span> <span class="id">ri</span>,  [<span class="id">r12</span>, #(<span class="id">i</span>*8 + 8)];                (**<span class="id">r</span> <span class="id">Store</span> <span class="id">Stage</span> *) <span class="id">i</span> \<span class="kwd">in</span>[0, 10]
<span class="id">ldr</span> <span class="id">ri</span>,  [<span class="id">sp</span>, #(<span class="id">i</span>*4)];                     (**<span class="id">r</span> <span class="id">Reset</span> <span class="id">Stage</span> *) <span class="id">i</span> \<span class="kwd">in</span> [4-11]
<span class="id">ldr</span> <span class="id">sp</span>,  [<span class="id">sp</span>, #0]; <span class="id">bx</span> <span class="id">lr</span>                   (**<span class="id">r</span> <span class="id">Post</span> <span class="id">Stage</span> *)

<span class="kwd">where</span>
1) <span class="id">Pre</span>  <span class="id">Stage</span>: <span class="id">use</span> <span class="id">arm32</span> <span class="id">IR12</span> <span class="kwd">as</span> <span class="id">the</span> <span class="id">start</span> <span class="id">address</span> <span class="id">of</span> <span class="id">the</span> <span class="id">jit</span> <span class="id">state</span>;
2) <span class="kwd">Save</span> <span class="id">Stage</span>: <span class="id">store</span> <span class="id">selected</span> <span class="id">arm32</span> <span class="id">registers</span> <span class="id">into</span> <span class="id">the</span> <span class="id">stack</span>; (<span class="id">i.e</span>. <span class="id">calling</span> <span class="id">conversion</span>)
3) <span class="kwd">Load</span> <span class="id">Stage</span>: <span class="id">load</span> <span class="id">related</span> <span class="id">BPF</span> <span class="id">registers</span> (<span class="id">only</span> <span class="id">low</span> 32-<span class="id">bits</span>) <span class="id">into</span> <span class="id">arm32</span> <span class="id">registers</span>;
4) <span class="id">Jitted</span> <span class="id">Stage</span>: <span class="id">generate</span> <span class="id">core</span> <span class="id">BPF</span>-<span class="id">alu32</span>-<span class="id">jitted</span> <span class="id">thumb</span> <span class="id">code</span>;
5) <span class="id">Store</span> <span class="id">Stage</span>: <span class="id">store</span> <span class="id">related</span> <span class="id">arm32</span> <span class="id">registers</span> <span class="id">into</span> <span class="id">BPF</span> <span class="id">registers</span> (<span class="id">high</span> 32-<span class="id">bits</span> <span class="id">all</span> 0);
6) <span class="id">Reset</span> <span class="id">Stage</span>: <span class="id">recover</span> <span class="id">related</span> <span class="id">arm32</span> <span class="id">registers</span> <span class="id">from</span> <span class="id">the</span> <span class="id">stack</span>;  (<span class="id">i.e</span>. <span class="id">calling</span> <span class="id">conversion</span>)
7) <span class="id">Post</span> <span class="id">Stage</span>: <span class="id">recover</span> <span class="id">the</span> <span class="id">arm32</span> <span class="id">IR12</span> <span class="id">register</span> <span class="id">and</span> <span class="id">jump</span>.

<span class="id">so</span>, <span class="id">before</span> <span class="id">call</span> <span class="id">jitted</span> <span class="id">thumb</span> <span class="id">code</span>, <span class="id">the</span> <span class="id">initial</span> <span class="id">thumb</span> <span class="id">state</span> <span class="id">has</span> <span class="id">the</span> <span class="id">information</span> <span class="id">that</span>:
- <span class="id">a</span> <span class="id">special</span> <span class="id">arm</span> <span class="id">register</span> (<span class="kwd">let</span>'<span class="id">s</span> <span class="id">say</span> <span class="id">IR12</span>) <span class="id">points</span> <span class="id">to</span> <span class="id">the</span> <span class="id">start</span> <span class="id">address</span> <span class="id">of</span> <span class="id">the</span> <span class="id">jit</span> <span class="id">state</span>.
- <span class="id">Ri</span> <span class="id">points</span> <span class="id">to</span> <span class="id">the</span> <span class="id">corresponding</span> <span class="id">BPF</span> <span class="id">Ri</span>

 *)

(**<span class="id">r</span> <span class="kwd">let</span>'<span class="id">s</span> <span class="id">say</span> <span class="id">IR12</span> <span class="id">storing</span> <span class="id">the</span> <span class="id">start</span> <span class="id">address</span> <span class="id">of</span> <span class="id">the</span> <span class="id">rBPF</span> <span class="id">state</span> *)
(**<span class="id">r</span> <span class="id">we</span> <span class="id">will</span> <span class="id">use</span> <span class="id">this</span> <span class="id">one</span> <span class="kwd">as</span> <span class="id">an</span> <span class="id">additional</span> <span class="id">register</span> <span class="kwd">for</span> <span class="id">the</span> <span class="id">src</span> <span class="id">of</span> <span class="id">BPF_ALU32_IMM</span> <span class="id">because</span> <span class="id">CompCert</span> <span class="id">ARM32</span> <span class="id">uses</span> <span class="id">IR12</span> <span class="kwd">as</span> <span class="id">frame</span> <span class="id">pointer</span>, <span class="id">so</span> <span class="id">we</span> <span class="id">have</span> <span class="id">no</span> <span class="id">choice</span> <span class="id">but</span> <span class="id">only</span> <span class="id">use</span> <span class="id">IR11</span> <span class="kwd">as</span> <span class="id">IP</span>. *)

(**<span class="id">r</span> <span class="id">MUST</span> <span class="id">div</span> <span class="tactic">by</span> 2 <span class="id">before</span> <span class="id">call</span> `<span class="id">construct_thumb_b</span>` <span class="id">because</span> <span class="id">of</span> `<span class="id">P</span> <span class="id">label</span>` <span class="kwd">where</span> <span class="id">label</span> = <span class="id">imm20</span> = <span class="id">S</span>:<span class="id">J2</span>:<span class="id">J1</span>:<span class="id">imm6</span>:<span class="id">imm11</span> *)

<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> (<span class="id">op</span> <span class="id">rt</span> <span class="id">rn</span> <span class="id">imm12</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>): <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span> :=
  <span class="kwd">let</span> <span class="id">str_low</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">rn</span> <span class="id">op</span> 0 4 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">str_high</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">rt</span> <span class="id">imm12</span> 12 4 <span class="kwd">in</span>
    <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">str_high</span> <span class="id">str_low</span> 16 16.

(** * <span class="id">Pre</span> <span class="id">Stage</span>: <span class="id">mov</span> *)

<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32_pre">jit_alu32_pre</a></span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  (* <span class="id">the</span> <span class="id">allocation</span> <span class="id">will</span> <span class="tactic">do</span> `<span class="id">STR</span> <span class="id">IR12</span> [<span class="id">SP</span>, #+0]` *)
  (**<span class="id">r</span> <span class="id">MOV</span> <span class="id">IR12</span> <span class="id">R1</span> *) (**<span class="id">r</span> 12 = 0<span class="id">b</span> 1100 *)
  <span class="kwd">let</span> <span class="id">ins_rdn</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 4) <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOV_R_OP">MOV_R_OP</a></span> 0 3 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">ins_rm</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.one">Int.one</a></span>  <span class="id">ins_rdn</span> 3 4 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">ins</span>     := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.one">Int.one</a></span> <span class="id">ins_rm</span> 7 1 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">ins32</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins</span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#NOP_OP">NOP_OP</a></span> 16 16 <span class="kwd">in</span>

  (**<span class="id">r</span> <span class="id">STR</span> <span class="id">IR11</span> [<span class="id">SP</span>, #44] *)
  <span class="kwd">let</span> <span class="id">str</span>   := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#STR_I_OP">STR_I_OP</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 11) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">SP</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 44) <span class="kwd">in</span>
    [<span class="id">ins32</span>; <span class="id">str</span>].


(** * <span class="id">Jitted</span> <span class="id">Code</span>: <span class="id">from</span> <span class="id">BPF</span> <span class="id">alu32</span> <span class="id">to</span> <span class="id">thumb</span> <span class="id">alu</span> *)

<span class="kwd">Definition</span> <span class="id"><a name="jit_call_save_add">jit_call_save_add</a></span> (<span class="id">r</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">ls</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>): <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_mem">set_mem</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg_eq">breg_eq</a></span> <span class="id">r</span> <span class="id">ls</span> <span class="kwd">then</span>
    []
  <span class="kwd">else</span>
    (**<span class="id">r</span> <span class="id">determine</span> <span class="kwd">if</span> <span class="id">we</span> <span class="id">should</span> <span class="tactic">do</span> <span class="id">calling_convention</span>, <span class="id">depends</span> <span class="id">on</span> <span class="id">r</span> [4, 11] *) (*
    <span class="kwd">if</span> (<span class="id">Int.ltu</span> (<span class="id">Int.repr</span> 3) (<span class="id">int_of_reg</span> <span class="id">r</span>)) &amp;&amp; (<span class="id">Int.ltu</span> (<span class="id">int_of_reg</span> <span class="id">r</span>) (<span class="id">int_of_ireg</span> <span class="id">IR12</span>)) <span class="kwd">then</span> *)
    <span class="kwd">let</span> <span class="id">ldr_ins</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#LDR_I_OP">LDR_I_OP</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">r</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR12">IR12</a></span>)
                  (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.mul">Int.mul</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">r</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 4)) <span class="kwd">in</span>
      <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_mem">set_mem</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg_eq">breg_eq</a></span> <span class="id">r</span> <span class="id"><a href="bpf.rbpf32.JITConfig.html#rbpf_arm_callee_save">rbpf_arm_callee_save</a></span> <span class="kwd">then</span>
        <span class="kwd">let</span> <span class="id">str_ins</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#STR_I_OP">STR_I_OP</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">r</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">SP</span>)
                      (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.mul">Int.mul</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">r</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 4)) <span class="kwd">in</span>
          [<span class="id">str_ins</span>; <span class="id">ldr_ins</span>]
        <span class="kwd">else</span>
          [<span class="id">ldr_ins</span>].

<span class="kwd">Definition</span> <span class="id"><a name="jit_call_save_reg">jit_call_save_reg</a></span> (<span class="id">dst</span> <span class="id">src</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">ld_set</span> <span class="id">st_set</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>): <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span> :=
  <span class="kwd">let</span> <span class="id">l1</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_call_save_add">jit_call_save_add</a></span> <span class="id">dst</span> <span class="id">ld_set</span> <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">ld_set1</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg_eq">breg_eq</a></span> <span class="id">dst</span> <span class="id">ld_set</span> <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">st_set1</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg_eq">breg_eq</a></span> <span class="id">dst</span> <span class="id">st_set</span> <span class="kwd">in</span>

  <span class="kwd">let</span> <span class="id">l2</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_call_save_add">jit_call_save_add</a></span> <span class="id">src</span> <span class="id">ld_set1</span> <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">ld_set2</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg_eq">breg_eq</a></span> <span class="id">src</span> <span class="id">ld_set1</span> <span class="kwd">in</span>
    (<span class="id">l1</span> ++ <span class="id">l2</span>, <span class="id">ld_set2</span>, <span class="id">st_set1</span>).

<span class="kwd">Definition</span> <span class="id"><a name="jit_call_save_imm">jit_call_save_imm</a></span> (<span class="id">dst</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">ld_set</span> <span class="id">st_set</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>): <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span> :=
  <span class="kwd">let</span> <span class="id">l1</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_call_save_add">jit_call_save_add</a></span> <span class="id">dst</span> <span class="id">ld_set</span> (*(<span class="id">set_union</span> <span class="id">breg_eq</span> <span class="id">ld_set</span> <span class="id">st_set</span>)*) <span class="kwd">in</span>
    (<span class="id">l1</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg_eq">breg_eq</a></span> <span class="id">dst</span> <span class="id">ld_set</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg_eq">breg_eq</a></span> <span class="id">dst</span> <span class="id">st_set</span>).

<span class="kwd">Definition</span> <span class="id"><a name="bpf_alu32_to_thumb_reg_comm">bpf_alu32_to_thumb_reg_comm</a></span> (<span class="id">op</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>) (<span class="id">dst</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">src</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#ireg">ireg</a></span>) : <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span> :=
  <span class="kwd">let</span> <span class="id">ins_lo</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id">op</span> 0 4 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">ins_hi</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">src</span>) 8 4 <span class="kwd">in</span>
    <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_hi</span> <span class="id">ins_lo</span> 16 16.

(**<span class="id">r</span> <span class="id">src</span> <span class="id">may</span> <span class="id">be</span> <span class="id">IR11</span> <span class="id">because</span> <span class="id">of</span> <span class="id">bpf_alu32_to_thumb_imm</span> *)
<span class="kwd">Definition</span> <span class="id"><a name="bpf_alu32_to_thumb_reg">bpf_alu32_to_thumb_reg</a></span> (<span class="id">op</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#aluOp">aluOp</a></span>) (<span class="id">dst</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">src</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#ireg">ireg</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">match</span> <span class="id">op</span> <span class="kwd">with</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#ADD">ADD</a></span>   =&gt;
    <span class="kwd">let</span> <span class="id">d</span>       := <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.lt">Int.lt</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 8) <span class="kwd">then</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">else</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.one">Int.one</a></span> <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">rdn</span>     := <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.lt">Int.lt</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 8) <span class="kwd">then</span>
                      (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>)
                    <span class="kwd">else</span>
                      <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.sub">Int.sub</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 8) <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_rdn</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">rdn</span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#ADD_R_OP">ADD_R_OP</a></span> 0 3 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_rm</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">src</span>) <span class="id">ins_rdn</span> 3 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins</span>     := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">d</span> <span class="id">ins_rm</span> 7 1 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins32</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins</span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#NOP_OP">NOP_OP</a></span> 16 16 <span class="kwd">in</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id">ins32</span>]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#SUB">SUB</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg_comm">bpf_alu32_to_thumb_reg_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#SUB_R_OP">SUB_R_OP</a></span> <span class="id">dst</span> <span class="id">src</span>]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MUL">MUL</a></span>   =&gt;
    <span class="kwd">let</span> <span class="id">ins_lo</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#MUL_OP">MUL_OP</a></span> 0 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_hi0</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">src</span>) 8 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_hi</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 0<span class="id">xf</span>) <span class="id">ins_hi0</span> 12 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins32</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_hi</span> <span class="id">ins_lo</span> 16 16 <span class="kwd">in</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id">ins32</span>]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#DIV">DIV</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>

  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#OR">OR</a></span>    =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg_comm">bpf_alu32_to_thumb_reg_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#ORR_R_OP">ORR_R_OP</a></span> <span class="id">dst</span> <span class="id">src</span>]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#AND">AND</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg_comm">bpf_alu32_to_thumb_reg_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#AND_R_OP">AND_R_OP</a></span> <span class="id">dst</span> <span class="id">src</span>]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#LSH">LSH</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#RSH">RSH</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#NEG">NEG</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MOD">MOD</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#XOR">XOR</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg_comm">bpf_alu32_to_thumb_reg_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#EOR_R_OP">EOR_R_OP</a></span> <span class="id">dst</span> <span class="id">src</span>]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MOV">MOV</a></span>   =&gt;
    (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">for</span> `<span class="id">mov</span> <span class="id">ri</span> <span class="id">ri</span>`, <span class="id">we</span> <span class="id">generate</span> <span class="id">nothing</span> *)
    <span class="kwd">if</span> <span class="id"><a href="bpf.jit.Arm32Reg.html#reg_ireg_eqb">reg_ireg_eqb</a></span> <span class="id">dst</span> <span class="id">src</span> <span class="kwd">then</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> []
    <span class="kwd">else</span>
      <span class="kwd">let</span> <span class="id">d</span>       := <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.lt">Int.lt</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 8) <span class="kwd">then</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">else</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.one">Int.one</a></span> <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">rdn</span>     := <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.lt">Int.lt</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 8) <span class="kwd">then</span>
                        (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>)
                      <span class="kwd">else</span>
                        <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.sub">Int.sub</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 8) <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">ins_rdn</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">rdn</span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOV_R_OP">MOV_R_OP</a></span> 0 3 <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">ins_rm</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">src</span>)  <span class="id">ins_rdn</span> 3 4 <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">ins</span>     := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">d</span> <span class="id">ins_rm</span> 7 1 <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">ins32</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins</span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#NOP_OP">NOP_OP</a></span> 16 16 <span class="kwd">in</span>
        <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id">ins32</span>]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#ARSH">ARSH</a></span>  =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  <span class="kwd">end</span>.

(**<span class="id">r</span> <span class="tactic">move</span> <span class="id">imm32</span> <span class="id">low16</span>-<span class="id">bit</span> <span class="id">to</span> <span class="id">ireg</span> *)

<span class="kwd">Definition</span> <span class="id"><a name="mov_int_to_movwt">mov_int_to_movwt</a></span> (<span class="id">i</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>) (<span class="id">r</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#ireg">ireg</a></span>) (<span class="id">op</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>): <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span> :=
  <span class="kwd">let</span> <span class="id">lo_imm8</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">i</span> 0  8 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">lo_imm3</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">i</span> 8  3 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">lo_i</span>      := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">i</span> 11 1 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">lo_imm4</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">i</span> 12 4 <span class="kwd">in</span>
(**<span class="id">r</span> - <span class="id">encoding</span> <span class="id">T3</span>
<span class="id">MOVW</span> <span class="id">Rd</span>, #<span class="id">imm16</span> (= <span class="id">imm4</span>:<span class="id">i</span>:<span class="id">imm3</span>:<span class="id">imm8</span>)

 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0     1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0
 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0     5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0
 --------------------------------    --------------------------------
|1 1 1 1 0|<span class="id">i</span>|1 0|0|1|0 0| <span class="id">imm4</span>  |   |0| <span class="id">imm3</span>|  <span class="id">Rd</span>   |  <span class="id">imm8</span>         |
 --------------------------------    -------------------------------- *)
  <span class="kwd">let</span> <span class="id">movw_lo_0</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">lo_imm4</span> <span class="id">op</span>        0  4 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">movw_lo</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">lo_i</span>    <span class="id">movw_lo_0</span> 10 1 <span class="kwd">in</span>

  <span class="kwd">let</span> <span class="id">movw_hi_0</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">r</span>) <span class="id">lo_imm8</span> 8 4 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">movw_hi</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">lo_imm3</span> <span class="id">movw_hi_0</span> 12 3 <span class="kwd">in</span>
    <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">movw_hi</span> <span class="id">movw_lo</span> 16 16.

(**<span class="id">r</span> - <span class="id">encoding</span> <span class="id">T1</span>
<span class="id">MOVT</span> <span class="id">Rd</span>, #<span class="id">imm16</span> (= <span class="id">imm4</span>:<span class="id">i</span>:<span class="id">imm3</span>:<span class="id">imm8</span>)

 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0     1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0
 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0     5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0
 --------------------------------    --------------------------------
|1 1 1 1 0|<span class="id">i</span>|1 0|1|1|0|0| <span class="id">imm4</span>  |   |0| <span class="id">imm3</span>|  <span class="id">Rd</span>   |  <span class="id">imm8</span>         |
 --------------------------------    -------------------------------- *)

<span class="kwd">Definition</span> <span class="id"><a name="bpf_alu32_to_thumb_imm_comm">bpf_alu32_to_thumb_imm_comm</a></span> (<span class="id">op</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>) (<span class="id">alu_op</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#aluOp">aluOp</a></span>) (<span class="id">dst</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">imm32</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">if</span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.cmpu">Int.cmpu</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Cle">Cle</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> <span class="id">imm32</span>) &amp;&amp; (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.cmpu">Int.cmpu</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Cle">Cle</a></span> <span class="id">imm32</span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 255)) <span class="kwd">then</span> (**<span class="id">r</span> 0 &lt;= <span class="id">imm32</span> &lt;= 255 *)
    <span class="kwd">let</span> <span class="id">ins_lo</span>    := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id">op</span> 0 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_hi</span>    := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id">imm32</span> 8 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins32</span>     := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_hi</span> <span class="id">ins_lo</span> 16 16 <span class="kwd">in</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id">ins32</span>]
  <span class="kwd">else</span>
    <span class="kwd">let</span> <span class="id">lo_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 0 16 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">hi_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 16 16 <span class="kwd">in</span>
      <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.eq">Int.eq</a></span> <span class="id">lo_32</span> <span class="id">imm32</span> <span class="kwd">then</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> = 0 <span class="kwd">then</span> <span class="id">only</span> <span class="id">add</span> `<span class="id">movw</span>` *)
        <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg">bpf_alu32_to_thumb_reg</a></span> <span class="id">alu_op</span> <span class="id">dst</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="kwd">with</span>
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>) :: <span class="id">l</span>)
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
        <span class="kwd">end</span>
      <span class="kwd">else</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> &lt;&gt; 0 <span class="kwd">then</span> <span class="id">add</span>`<span class="id">movt</span> + <span class="id">movw</span>` *)
        <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg">bpf_alu32_to_thumb_reg</a></span> <span class="id">alu_op</span> <span class="id">dst</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="kwd">with</span>
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt;
          (**<span class="id">r</span> <span class="id">adding</span> <span class="id">movw</span> <span class="id">movt</span>: <span class="id">must</span> <span class="id">firstly</span> <span class="id">w</span> <span class="kwd">then</span> <span class="id">t</span> *)
          <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>) :: (<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">hi_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVT_OP">MOVT_OP</a></span>) :: <span class="id">l</span>)
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
        <span class="kwd">end</span>.

<span class="kwd">Definition</span> <span class="id"><a name="bpf_alu32_to_thumb_imm_shift_comm">bpf_alu32_to_thumb_imm_shift_comm</a></span> (<span class="id">op</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>) (<span class="id">dst</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">imm32</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  (**<span class="id">r</span> <span class="id">CompCert</span> <span class="id">doesn</span>'<span class="id">t</span> <span class="id">have</span> <span class="id">lsh_imm</span>, <span class="id">so</span> <span class="id">we</span> <span class="tactic">do</span> `<span class="id">mov</span> + <span class="id">lsh_reg</span>` *)
  (**<span class="id">r</span> <span class="id">BPF</span> <span class="id">verifier</span> <span class="id">should</span> <span class="id">guarantee</span> 0 &lt;= <span class="id">imm32</span> &lt; 32 <span class="kwd">for</span> <span class="id">lsh_imm</span> *)
  <span class="kwd">if</span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.cmpu">Int.cmpu</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Cle">Cle</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> <span class="id">imm32</span>) &amp;&amp; (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.cmpu">Int.cmpu</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Clt">Clt</a></span> <span class="id">imm32</span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 32)) <span class="kwd">then</span>
    (**<span class="id">r</span> <span class="id">construct</span>: <span class="id">lsl</span>/<span class="id">lsr</span>/<span class="id">asr</span> <span class="id">Rd</span> <span class="id">Rn</span> <span class="id">Rm</span> *)
    <span class="kwd">let</span> <span class="id">ins_lo</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id">op</span> 0 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_hi0</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span>) 8 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_hi</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 0<span class="id">xf</span>) <span class="id">ins_hi0</span> 12 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins32</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_hi</span> <span class="id">ins_lo</span> 16 16 <span class="kwd">in</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">imm32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>; <span class="id">ins32</span>]
  <span class="kwd">else</span>
    <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.

<span class="kwd">Definition</span> <span class="id"><a name="bpf_alu32_to_thumb_imm">bpf_alu32_to_thumb_imm</a></span> (<span class="id">op</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#aluOp">aluOp</a></span>) (<span class="id">dst</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">imm32</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">match</span> <span class="id">op</span> <span class="kwd">with</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#ADD">ADD</a></span>   =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_comm">bpf_alu32_to_thumb_imm_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#ADD_I_OP">ADD_I_OP</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#ADD">ADD</a></span> <span class="id">dst</span> <span class="id">imm32</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#SUB">SUB</a></span>   =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_comm">bpf_alu32_to_thumb_imm_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#SUB_I_OP">SUB_I_OP</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#SUB">SUB</a></span> <span class="id">dst</span> <span class="id">imm32</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MUL">MUL</a></span>   =&gt; (**<span class="id">r</span> <span class="id">CompCert</span> <span class="id">doesn</span>'<span class="id">t</span> <span class="id">have</span> <span class="id">mul_imm</span>, <span class="id">so</span> <span class="id">we</span> <span class="tactic">do</span> `<span class="id">mov</span> + <span class="id">mul_reg</span>` *)
    <span class="kwd">let</span> <span class="id">lo_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 0 16 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">hi_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 16 16 <span class="kwd">in</span>
      <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.eq">Int.eq</a></span> <span class="id">lo_32</span> <span class="id">imm32</span> <span class="kwd">then</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> = 0 <span class="kwd">then</span> <span class="id">only</span> <span class="id">add</span> `<span class="id">movw</span>` *)
        <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg">bpf_alu32_to_thumb_reg</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MUL">MUL</a></span> <span class="id">dst</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="kwd">with</span>
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>) :: <span class="id">l</span>)
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
        <span class="kwd">end</span>
      <span class="kwd">else</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> &lt;&gt; 0 <span class="kwd">then</span> <span class="id">add</span>`<span class="id">movt</span> + <span class="id">movw</span>` *)
        (**<span class="id">r</span> <span class="id">adding</span> <span class="id">movw</span> <span class="id">movt</span>: <span class="id">must</span> <span class="id">firstly</span> <span class="id">w</span> <span class="kwd">then</span> <span class="id">t</span> *)
        <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg">bpf_alu32_to_thumb_reg</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MUL">MUL</a></span> <span class="id">dst</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="kwd">with</span>
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>) ::
              (<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">hi_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVT_OP">MOVT_OP</a></span>) :: <span class="id">l</span>)
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
        <span class="kwd">end</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#DIV">DIV</a></span>   =&gt; (**<span class="id">r</span> <span class="id">CompCert</span> <span class="id">doesn</span>'<span class="id">t</span> <span class="id">have</span> <span class="id">div_imm</span>, <span class="id">so</span> <span class="id">we</span> <span class="tactic">do</span> `<span class="id">mov</span> + <span class="id">div_reg</span>` *)
    <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.eq">Int.eq</a></span> <span class="id">imm32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">then</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
    <span class="kwd">else</span> 
      (**<span class="id">r</span> <span class="id">construct</span>: <span class="id">udiv</span> <span class="id">Rd</span> <span class="id">Rn</span> <span class="id">Rm</span> *)
      <span class="kwd">let</span> <span class="id">ins_lo</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#UDIV_LO_OP">UDIV_LO_OP</a></span> 0 4 <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">ins_hi0</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#UDIV_HI_OP">UDIV_HI_OP</a></span> 8 4 <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">ins_hi</span>  := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span>) <span class="id">ins_hi0</span> 0 4 <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">ins32</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_hi</span> <span class="id">ins_lo</span> 16 16 <span class="kwd">in</span>

      <span class="kwd">let</span> <span class="id">lo_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 0 16 <span class="kwd">in</span>
      <span class="kwd">let</span> <span class="id">hi_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 16 16 <span class="kwd">in</span>
        <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.eq">Int.eq</a></span> <span class="id">lo_32</span> <span class="id">imm32</span> <span class="kwd">then</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> = 0 <span class="kwd">then</span> <span class="id">only</span> <span class="id">add</span> `<span class="id">movw</span>` *)
          <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>; <span class="id">ins32</span>]
        <span class="kwd">else</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> &lt;&gt; 0 <span class="kwd">then</span> <span class="id">add</span>`<span class="id">movt</span> + <span class="id">movw</span>` *)
          (**<span class="id">r</span> <span class="id">adding</span> <span class="id">movw</span> <span class="id">movt</span>: <span class="id">must</span> <span class="id">firstly</span> <span class="id">w</span> <span class="kwd">then</span> <span class="id">t</span> *)
          <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>; <span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">hi_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVT_OP">MOVT_OP</a></span>; <span class="id">ins32</span>]

  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#OR">OR</a></span>    =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_comm">bpf_alu32_to_thumb_imm_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#ORR_I_OP">ORR_I_OP</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#OR">OR</a></span>  <span class="id">dst</span> <span class="id">imm32</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#AND">AND</a></span>   =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_comm">bpf_alu32_to_thumb_imm_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#AND_I_OP">AND_I_OP</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#AND">AND</a></span> <span class="id">dst</span> <span class="id">imm32</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#LSH">LSH</a></span>   =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_shift_comm">bpf_alu32_to_thumb_imm_shift_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#LSL_R_OP">LSL_R_OP</a></span> <span class="id">dst</span> <span class="id">imm32</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#RSH">RSH</a></span>   =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_shift_comm">bpf_alu32_to_thumb_imm_shift_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#LSR_R_OP">LSR_R_OP</a></span> <span class="id">dst</span> <span class="id">imm32</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#NEG">NEG</a></span>   =&gt;
    <span class="kwd">let</span> <span class="id">ins_lo</span>    := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#RSB_I_OP">RSB_I_OP</a></span> 0 4 <span class="kwd">in</span> (**<span class="id">r</span> <span class="id">dst</span> = 0 - <span class="id">IR11</span> *)
    <span class="kwd">let</span> <span class="id">ins_hi</span>    := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">dst</span>) <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> 8 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins32</span>     := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_hi</span> <span class="id">ins_lo</span> 16 16 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">lo_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 0 16 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">hi_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 16 16 <span class="kwd">in</span>
      <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.eq">Int.eq</a></span> <span class="id">lo_32</span> <span class="id">imm32</span> <span class="kwd">then</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> = 0 <span class="kwd">then</span> <span class="id">only</span> <span class="id">add</span> `<span class="id">movw</span>` *)
        <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>) :: [<span class="id">ins32</span>])
      <span class="kwd">else</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> &lt;&gt; 0 <span class="kwd">then</span> <span class="id">add</span>`<span class="id">movt</span> + <span class="id">movw</span>` *)
        (**<span class="id">r</span> <span class="id">adding</span> <span class="id">movw</span> <span class="id">movt</span>: <span class="id">must</span> <span class="id">firstly</span> <span class="id">w</span> <span class="kwd">then</span> <span class="id">t</span> *)
        <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>) ::
              (<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">hi_32</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR11">IR11</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVT_OP">MOVT_OP</a></span>) :: [<span class="id">ins32</span>])
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MOD">MOD</a></span>   =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#XOR">XOR</a></span>   =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_comm">bpf_alu32_to_thumb_imm_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#EOR_I_OP">EOR_I_OP</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#XOR">XOR</a></span> <span class="id">dst</span> <span class="id">imm32</span>
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#MOV">MOV</a></span>   =&gt;
    <span class="kwd">let</span> <span class="id">lo_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 0 16 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">hi_32</span> := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#decode_arm32">decode_arm32</a></span> <span class="id">imm32</span> 16 16 <span class="kwd">in</span>
      <span class="kwd">if</span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.eq">Int.eq</a></span> <span class="id">lo_32</span> <span class="id">imm32</span> <span class="kwd">then</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> = 0 <span class="kwd">then</span> <span class="id">only</span> <span class="id">add</span> `<span class="id">movw</span>` *)
        <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#ireg_of_breg">ireg_of_breg</a></span> <span class="id">dst</span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>]
      <span class="kwd">else</span> (**<span class="id">r</span> <span class="id">optimization</span>: <span class="kwd">if</span> <span class="id">high_16</span> &lt;&gt; 0 <span class="kwd">then</span> <span class="id">add</span>`<span class="id">movt</span> + <span class="id">movw</span>` *)
        (**<span class="id">r</span> <span class="id">adding</span> <span class="id">movw</span> <span class="id">movt</span>: <span class="id">must</span> <span class="id">firstly</span> <span class="id">w</span> <span class="kwd">then</span> <span class="id">t</span> *)
        <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">lo_32</span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#ireg_of_breg">ireg_of_breg</a></span> <span class="id">dst</span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVW_OP">MOVW_OP</a></span>;
          (<span class="id"><a href="bpf.jit.ThumbJIT.html#mov_int_to_movwt">mov_int_to_movwt</a></span> <span class="id">hi_32</span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#ireg_of_breg">ireg_of_breg</a></span> <span class="id">dst</span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#MOVT_OP">MOVT_OP</a></span>)]
  | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#ARSH">ARSH</a></span>  =&gt; <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm_shift_comm">bpf_alu32_to_thumb_imm_shift_comm</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#ASR_R_OP">ASR_R_OP</a></span> <span class="id">dst</span> <span class="id">imm32</span>
  <span class="kwd">end</span>.


<span class="kwd">Definition</span> <span class="id"><a name="jit_one">jit_one</a></span> (<span class="id">op</span>:<span class="id"><a href="bpf.rbpf32.TSSyntax.html#aluOp">aluOp</a></span>) (<span class="id">dst</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>) (<span class="id">src</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#breg">breg</a></span>+<span class="id"><a href="bpf.rbpf32.TSSyntax.html#imm">imm</a></span>) (<span class="id">ld_set</span> <span class="id">st_set</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>):
  <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>) :=
  <span class="kwd">match</span> <span class="id">src</span> <span class="kwd">with</span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">r</span> =&gt;
    <span class="kwd">let</span> '(<span class="id">l1</span>, <span class="id">ld_set1</span>, <span class="id">st_set1</span>) := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_call_save_reg">jit_call_save_reg</a></span> <span class="id">dst</span> <span class="id">r</span> <span class="id">ld_set</span> <span class="id">st_set</span> <span class="kwd">in</span>
      <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_reg">bpf_alu32_to_thumb_reg</a></span> <span class="id">op</span> <span class="id">dst</span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#ireg_of_breg">ireg_of_breg</a></span> <span class="id">r</span>) <span class="kwd">with</span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>, <span class="id">ld_set1</span>, <span class="id">st_set1</span>)
      <span class="kwd">end</span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">i</span> =&gt;
    <span class="kwd">let</span> '(<span class="id">l1</span>, <span class="id">ld_set1</span>, <span class="id">st_set1</span>) := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_call_save_imm">jit_call_save_imm</a></span> <span class="id">dst</span> <span class="id">ld_set</span> <span class="id">st_set</span> <span class="kwd">in</span>
      <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#bpf_alu32_to_thumb_imm">bpf_alu32_to_thumb_imm</a></span> <span class="id">op</span> <span class="id">dst</span> <span class="id">i</span> <span class="kwd">with</span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>, <span class="id">ld_set1</span>, <span class="id">st_set1</span>)
      <span class="kwd">end</span>
  <span class="kwd">end</span>.

<span class="kwd">Fixpoint</span> <span class="id"><a name="jit_sequence">jit_sequence</a></span> (<span class="id">l</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bpf_code">bpf_code</a></span>) (<span class="id">ld_set</span> <span class="id">st_set</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>):
  <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span> * <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>) :=
  <span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span>
  | [] =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ([], <span class="id">ld_set</span>, <span class="id">st_set</span>)
  | <span class="id">hd</span> :: <span class="id">tl</span> =&gt;
    <span class="kwd">match</span> <span class="id">hd</span> <span class="kwd">with</span>
    | <span class="id"><a href="bpf.rbpf32.TSSyntax.html#Palu32">Palu32</a></span> <span class="id">op</span> <span class="id">dst</span> <span class="id">src</span> =&gt;
      <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_one">jit_one</a></span> <span class="id">op</span> <span class="id">dst</span> <span class="id">src</span> <span class="id">ld_set</span> <span class="id">st_set</span> <span class="kwd">with</span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">l1</span>, <span class="id">ld1</span>, <span class="id">st1</span>) =&gt;
        <span class="kwd">match</span> <span class="id">jit_sequence</span> <span class="id">tl</span> <span class="id">ld1</span> <span class="id">st1</span> <span class="kwd">with</span>
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
        | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">l2</span>, <span class="id">ld2</span>, <span class="id">st2</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">l1</span>++<span class="id">l2</span>, <span class="id">ld2</span>, <span class="id">st2</span>)
        <span class="kwd">end</span>
      <span class="kwd">end</span>
    | <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
    <span class="kwd">end</span>
  <span class="kwd">end</span>.


<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32_thumb_pc_add">jit_alu32_thumb_pc_add</a></span> (<span class="id">imm32</span>: <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#int">int</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">if</span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.cmpu">Int.cmpu</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Cle">Cle</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> <span class="id">imm32</span>) &amp;&amp; (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.cmpu">Int.cmpu</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Cle">Cle</a></span> <span class="id">imm32</span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 255)) <span class="kwd">then</span> (**<span class="id">r</span> 0 &lt;= <span class="id">imm32</span> &lt;= 255 *)
    <span class="kwd">let</span> <span class="id">ins_lo</span>    := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 11) <span class="id"><a href="bpf.jit.ThumbInsOp.html#ADD_I_OP">ADD_I_OP</a></span> 0 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins_hi</span>    := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 11) <span class="id">imm32</span> 8 4 <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">ins32</span>     := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_hi</span> <span class="id">ins_lo</span> 16 16 <span class="kwd">in</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> [<span class="id">ins32</span>]
  <span class="kwd">else</span>
    <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.

<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32_thumb_pc">jit_alu32_thumb_pc</a></span> (<span class="id">num</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  (**<span class="id">r</span> <span class="id">TODO</span>: 2023-06-13
      <span class="id">ldr</span> <span class="id">r11</span>, [<span class="id">r12</span>, #44]
      <span class="id">add</span> <span class="id">r11</span>, (<span class="id">thumb_len</span> <span class="id">st</span>)
      <span class="id">str</span> <span class="id">r11</span>, [<span class="id">r12</span>, #44] *)
  <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_pc_add">jit_alu32_thumb_pc_add</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">num</span>)) <span class="kwd">with</span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt;
    <span class="kwd">let</span> <span class="id">l_ldr</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#LDR_I_OP">LDR_I_OP</a></span>
      (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 11) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR12">IR12</a></span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 44) <span class="kwd">in</span>
    <span class="kwd">let</span> <span class="id">l_str</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#STR_I_OP">STR_I_OP</a></span>
      (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 11) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR12">IR12</a></span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 44) <span class="kwd">in</span>
      <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ([<span class="id">l_ldr</span>] ++ <span class="id">l</span> ++ [<span class="id">l_str</span>])
  <span class="kwd">end</span>.

(** * <span class="id">Store</span> <span class="id">Stage</span>: <span class="id">Store</span> <span class="id">selected</span> <span class="id">arm32</span> <span class="id">registers</span> <span class="id">into</span> <span class="id">corresponding</span> <span class="id">BPF</span> <span class="id">registers</span> *)

<span class="kwd">Fixpoint</span> <span class="id"><a name="jit_alu32_thumb_store">jit_alu32_thumb_store</a></span> (<span class="id">st_set</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>): <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">match</span> <span class="id">st_set</span> <span class="kwd">with</span>
  | [] =&gt; []
  | <span class="id">hd</span> :: <span class="id">tl</span> =&gt;
    <span class="kwd">let</span> <span class="id">l_str</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#STR_I_OP">STR_I_OP</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">hd</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR12">IR12</a></span>)
                    (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.mul">Int.mul</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">hd</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 4)) <span class="kwd">in</span>
      [<span class="id">l_str</span>] ++ (<span class="id">jit_alu32_thumb_store</span> <span class="id">tl</span>)
  <span class="kwd">end</span>.

(** * <span class="id">Reset</span> <span class="id">Stage</span>: <span class="id">recover</span> <span class="id">the</span> <span class="id">initial</span> <span class="id">value</span> <span class="id">of</span> <span class="id">selected</span> <span class="id">arm32</span> <span class="id">registers</span> *)

(** @<span class="id">input</span>
  * @<span class="id">r</span>   : <span class="id">pop</span> <span class="id">register</span> <span class="id">r</span> <span class="id">from</span> <span class="id">the</span> <span class="id">stack</span>

  * @<span class="id">output</span>
  * @<span class="id">ins</span> :  <span class="id">binary</span> <span class="id">format</span> <span class="id">of</span> `<span class="id">ldr</span> <span class="id">r</span> [<span class="id">sp</span>, #+<span class="id">ofs</span>]` <span class="kwd">where</span> <span class="id">we</span> <span class="id">use</span> `<span class="id">ldr</span>` <span class="id">to</span> <span class="id">implement</span> `<span class="id">pop</span>`
  *)

<span class="kwd">Fixpoint</span> <span class="id"><a name="jit_alu32_thumb_reset1">jit_alu32_thumb_reset1</a></span> (<span class="id">ld_set</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>): <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">match</span> <span class="id">ld_set</span> <span class="kwd">with</span>
  | [] =&gt; []
  | <span class="id">hd</span> :: <span class="id">tl</span> =&gt;
    (**<span class="id">r</span> <span class="id">determine</span> <span class="kwd">if</span> <span class="id">we</span> <span class="id">should</span> <span class="tactic">do</span> <span class="id">calling_convention</span>, <span class="id">depends</span> <span class="id">on</span> <span class="id">r</span> [4, 11] <span class="kwd">where</span> 11 <span class="id">must</span> <span class="id">be</span> <span class="id">done</span> <span class="id">because</span> <span class="id">of</span> <span class="id">the</span> <span class="id">pre</span> <span class="id">Stage</span> *)
    (<span class="kwd">if</span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.ltu">Int.ltu</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 3) (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">hd</span>)) &amp;&amp; (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.ltu">Int.ltu</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">hd</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 11)) <span class="kwd">then</span>
      <span class="kwd">let</span> <span class="id">l_ldr</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#LDR_I_OP">LDR_I_OP</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">hd</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR13">IR13</a></span>)
                      (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.mul">Int.mul</a></span> (<span class="id"><a href="bpf.rbpf32.TSSyntax.html#int_of_breg">int_of_breg</a></span> <span class="id">hd</span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 4)) <span class="kwd">in</span>
      [<span class="id">l_ldr</span>]
    <span class="kwd">else</span>
      []) ++ (<span class="id">jit_alu32_thumb_reset1</span> <span class="id">tl</span>)
  <span class="kwd">end</span>.

<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32_thumb_reset">jit_alu32_thumb_reset</a></span> (<span class="id">ld_set</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#listset">listset</a></span>): <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">let</span> <span class="id">l_ldr</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#LDR_I_OP">LDR_I_OP</a></span> (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 11) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.AsmSyntax.html#IR13">IR13</a></span>) (<span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.repr">Int.repr</a></span> 44) <span class="kwd">in</span>
    [<span class="id">l_ldr</span>] ++ <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_reset1">jit_alu32_thumb_reset1</a></span> <span class="id">ld_set</span>.

(** <span class="id">Post</span>: <span class="id">LDR</span> <span class="id">SP</span> [<span class="id">SP</span>, #+0]; <span class="id">BX</span> <span class="id">LR</span> *)

<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32_post">jit_alu32_post</a></span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  (**<span class="id">r</span> <span class="id">LDR</span> <span class="id">SP</span> [<span class="id">SP</span>, #+0] *)
  <span class="kwd">let</span> <span class="id">l_ldr</span> := <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_mem_template_jit">jit_alu32_thumb_mem_template_jit</a></span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#LDR_I_OP">LDR_I_OP</a></span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">SP</span>) (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">SP</span>) <span class="id"><a href="https://compcert.org/doc/html/compcert.lib.Integers.html#Int.zero">Int.zero</a></span> <span class="kwd">in</span>
  (**<span class="id">r</span> <span class="id">BX</span> <span class="id">LR</span> *)
  <span class="kwd">let</span> <span class="id">ins_rm</span>   := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> (<span class="id"><a href="bpf.jit.Arm32Reg.html#int_of_ireg">int_of_ireg</a></span> <span class="id">RA</span>) <span class="id"><a href="bpf.jit.ThumbInsOp.html#BX_OP">BX_OP</a></span> 3 4 <span class="kwd">in</span>
  <span class="kwd">let</span> <span class="id">ins32</span>    := <span class="id"><a href="https://compcert.org/doc/html/compcert.arm.BinDecode.html#encode_arm32">encode_arm32</a></span> <span class="id">ins_rm</span> <span class="id"><a href="bpf.jit.ThumbInsOp.html#NOP_OP">NOP_OP</a></span> 16 16 <span class="kwd">in</span>
    [<span class="id">l_ldr</span>] ++ [<span class="id">ins32</span>].

(** * <span class="id">Jit</span> <span class="id">Procedure</span> *)

<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32_aux">jit_alu32_aux</a></span> (<span class="id">l</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bpf_code">bpf_code</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_sequence">jit_sequence</a></span> <span class="id">l</span> [] [] <span class="kwd">with</span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">cl</span>, <span class="id">ld_set</span>, <span class="id">st_set</span>) =&gt;
    <span class="kwd">match</span> <span class="id">cl</span> <span class="kwd">with</span>
    | [] =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (**<span class="id">r</span> <span class="id">we</span> <span class="id">don</span>'<span class="id">t</span> <span class="id">want</span> <span class="id">this</span> <span class="tactic">case</span>, <span class="id">wher</span> <span class="id">should</span> <span class="id">we</span> <span class="id">put</span> <span class="id">this</span> <span class="id">check</span>? *)
    | <span class="id">_</span> =&gt;
      <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_pc">jit_alu32_thumb_pc</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#length">List.length</a></span> <span class="id">l</span>) <span class="kwd">with</span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
      | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l_pc</span> =&gt;
        <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">cl</span> ++ <span class="id">l_pc</span> ++ (<span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_store">jit_alu32_thumb_store</a></span> (<span class="id"><a href="bpf.jit.ListSetSort.html#sort_listset">sort_listset</a></span> <span class="id">st_set</span>)) ++
              (<span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_thumb_reset">jit_alu32_thumb_reset</a></span> (<span class="id"><a href="bpf.jit.ListSetSort.html#sort_listset">sort_listset</a></span> <span class="id">ld_set</span>)))
      <span class="kwd">end</span>
    <span class="kwd">end</span>
  <span class="kwd">end</span>.

<span class="kwd">Definition</span> <span class="id"><a name="jit_alu32">jit_alu32</a></span> (<span class="id">l</span>: <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bpf_code">bpf_code</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="bpf.rbpf32.TSSyntax.html#bin_code">bin_code</a></span> :=
  <span class="kwd">match</span> <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_aux">jit_alu32_aux</a></span> <span class="id">l</span> <span class="kwd">with</span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>
  | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">bl</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_pre">jit_alu32_pre</a></span> ++ (<span class="id">bl</span> ++ <span class="id"><a href="bpf.jit.ThumbJIT.html#jit_alu32_post">jit_alu32_post</a></span>))
  <span class="kwd">end</span>.

<span class="id">Close</span> <span class="kwd">Scope</span> <span class="id">asm</span>.
<span class="id">Close</span> <span class="kwd">Scope</span> <span class="id">bool_scope</span>.
<span class="id">Close</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.]]]]</span></div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
